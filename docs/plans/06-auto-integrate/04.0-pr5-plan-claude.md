# Claude Code plan for PR 5: Remove Legacy Flag and Deprecated Interfaces

## Overview
This PR removes the `--legacy` flag and all deprecated interfaces after successful verification in PR 4. The codebase will have a single, clean path using the new TranscriptDocument-based architecture.

## Files to Modify

### 1. **src/youtube_to_xml/cli.py**
- Remove `--legacy` flag from argument parser (lines 46-50)
- Remove import of `parse_transcript_file` (line 12)
- Remove import of `chapters_to_xml` (line 14)
- Remove dual-path if/else logic (lines 83-90)
- Keep only new path: `document = parse_transcript_document(raw_transcript_text)` and `xml_output = transcript_to_xml(document)`

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

### 2. **src/youtube_to_xml/file_parser.py** âœ…
- Remove legacy Chapter class definition (lines 38-50)
- Remove `_extract_transcript_lines_for_chapters` function (lines 138-167)
- Remove `parse_transcript_file` function (lines 170-199)

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

### 3. **src/youtube_to_xml/xml_builder.py**
- Remove import of `FileParserChapter` from file_parser (line 8)
- Remove `chapters_to_xml` function (lines 61-72)

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

### 4. **tests/test_cli.py** âœ…
- Remove `_compare_parser_outputs` helper function (lines 9-48)
- Remove `@pytest.mark.parametrize("use_legacy", [False, True])` from `test_parser_path_selection` (line 120)
- Simplify `test_parser_path_selection` to test only new path
- Remove `test_both_paths_produce_identical_output` function entirely (lines 156-163)
- Remove `@pytest.mark.parametrize("legacy_flag", [True, False])` decorators from:
  - `test_both_paths_handle_empty_file_consistently` (line 164)
  - `test_both_paths_handle_invalid_format_consistently` (line 191)
  - `test_both_paths_handle_valid_transcript_consistently` (line 221)
- Simplify these tests to only test the new path (remove legacy_flag parameter and conditional logic)
- Update `test_multi_chapter_transcript_identical_output` to just test multi-chapter functionality

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

### 5. **tests/test_end_to_end.py**
- Remove `legacy` parameter from `run_script` function signature and logic (lines 36-45)
- Remove `@pytest.mark.parametrize("use_legacy", [False, True])` decorators from:
  - `test_file_multi_chapters_success` (line 94)
  - `test_file_chapters_with_blanks_success` (line 115)
  - `test_file_invalid_format_error` (line 135)
- Simplify these tests to only test the new path
- Remove entire legacy flag test section (lines 321-369): `test_legacy_vs_new_path_identical_output`

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

### 6. **tests/test_file_parser.py**
- **REMOVE FROM GIT**: Use `git rm tests/test_file_parser.py` to remove this file from version control
- This file contains extensive tests for legacy `parse_transcript_file` function
- Coverage is maintained through `test_file_parser_document.py`

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

### 7. **tests/test_xml_builder.py** âœ… **COVERAGE SATISFIED**

**PREPARATORY WORK COMPLETED:** Added comprehensive NEW tests covering all Legacy functionality. Functional equivalence verified.

**NOW SAFE TO REMOVE:**
- Import of `Chapter` from file_parser (line 12)
- Legacy Chapter fixtures: `single_chapter` and `multiple_chapters` (lines 26-80)
- 7 Legacy test functions (lines 86-223) that use `chapters_to_xml` and Legacy Chapter
- Keep all tests using `TranscriptDocument` and `transcript_to_xml` (lines 250-585)

ðŸ›‘ HALT: Stop after this step to verify and confirm completion. Ask Michelle for permission to continue and mark section "âœ…" only when approved.

## Test Simplification Strategy
For parametrized tests like `@pytest.mark.parametrize("use_legacy", [False, True])`:
- Remove the parametrize decorator
- Remove the parameter from the function signature
- Remove any conditional logic based on the parameter
- Keep the test logic for the new path only

## Git Operations Required
Before making code changes, ensure files are properly removed from version control:
```bash
git rm tests/test_file_parser.py
```

## Verification Steps
1. Run all tests to ensure coverage is maintained: `uv run pytest`
2. Run linting and formatting: `uv run ruff check --fix && uv run ruff format`
3. Verify CLI still works with example files
4. Ensure no imports of removed functions remain
5. Confirm git status shows file properly removed

## Expected Outcome
- Cleaner codebase with single source of truth
- No duplicate code paths
- All functionality preserved through new interfaces
- Test coverage maintained for the new path
- One file properly removed from git: `tests/test_file_parser.py`

## Safety Notes
- **Git Operations**: Always use `git rm` for files in version control, never just delete files
- **Test Coverage**: Verify `test_file_parser_document.py` covers all necessary scenarios before removing `test_file_parser.py`
- **Import Dependencies**: Check for any other files importing removed functions before deletion